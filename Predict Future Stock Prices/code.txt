import yfinance as yf
import pandas as pd
import matplotlib.pyplot as plt
from sklearn.ensemble import RandomForestRegressor
from sklearn.metrics import mean_squared_error
ticker = "TSLA"  # Let's try Tesla
print(f"Downloading data for {ticker}...")
data = yf.download(ticker, start="2022-01-01", end="2025-12-30")
data = data[['Open', 'High', 'Low', 'Close', 'Volume']]
data['Next_Close'] = data['Close'].shift(-1)
data.dropna(inplace=True)
X = data[['Open', 'High', 'Low', 'Volume']]
y = data['Next_Close']
train_size = int(len(data) * 0.8)
X_train, X_test = X.iloc[:train_size], X.iloc[train_size:]
y_train, y_test = y.iloc[:train_size], y.iloc[train_size:]
print("Training Random Forest model...")
model = RandomForestRegressor(n_estimators=100, random_state=42)
model.fit(X_train, y_train)
predictions = model.predict(X_test)
mse = mean_squared_error(y_test, predictions)
print(f"Mean Squared Error: {mse:.2f}")
plt.figure(figsize=(14, 7))
plt.plot(y_test.index, y_test, label='Actual Next Day Price', color='blue', alpha=0.6)
plt.plot(y_test.index, predictions, label='Predicted (Random Forest)', color='green', linestyle='--')
plt.title(f'Random Forest Prediction for {ticker}')
plt.xlabel('Date')
plt.ylabel('Price (USD)')
plt.legend()
plt.grid(True)
plt.show()
